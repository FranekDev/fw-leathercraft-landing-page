---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import StructuredData from "../components/StructuredData.astro";
import AnnouncementBanner from "../components/AnnouncementBanner.astro";
import Header from "../components/Header.astro";
import HeroSection from "../components/HeroSection.astro";
import CTASection from "../components/CTASection.astro";
import ProductsSection from "../components/ProductsSection.astro";
import SocialSection from "../components/SocialSection.astro";
import Footer from "../components/Footer.astro";
import ScrollToTop from "../components/ScrollToTop.astro";

const products = await getCollection("products");
const [siteEntry] = await getCollection("sites");

if (!siteEntry) {
  throw new Error(
    "No site configuration found. Please check your content/sites directory."
  );
}

const site = siteEntry.data;
---

<Layout title={site.title} description={site.description} url={site.url}>
  <AnnouncementBanner message={site.announcementMessage} />

  <!-- Main content container -->
  <div
    class="min-h-screen bg-(--bg) text-(--main) selection:text-(--bg) selection:bg-(--main)/60"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Hero Container - Full Viewport Height -->
      <div class="relative overflow-hidden min-h-screen">
        <!-- Header at top -->
        <div
          class="opacity-0 translate-y-6 transition-all duration-1000 ease-out delay-150 absolute top-0 left-0 right-0 z-10 animate-in transform-gpu"
        >
          <Header
            brandName={site.brandName}
            headerButtonText={site.headerButtonText}
            headerButtonUrl={site.headerButtonUrl}
          />
        </div>

        <!-- Centered Hero Content with integrated scroll indicator -->
        <div class="absolute inset-0 flex items-center justify-center px-4">
          <div
            class="opacity-0 translate-y-6 transition-all duration-1000 ease-out delay-300 w-full max-w-7xl animate-in transform-gpu"
          >
            <HeroSection
              heroTitle={site.heroTitle}
              heroDescription={site.heroDescription}
              slotsAvailable={site.slotsAvailable}
              slotsAvailableText={site.slotsAvailableText}
              slotsUnavailableText={site.slotsUnavailableText}
              scrollText={site.scrollText}
            />
          </div>
        </div>
      </div>

      <!-- Rest of the content -->
      <main class="space-y-4">
        <div
          class="opacity-0 translate-y-6 transition-all duration-1000 ease-out scroll-reveal"
        >
          <CTASection
            ctaTitle={site.ctaTitle}
            ctaSubtitle={site.ctaSubtitle}
            ctaDescription={site.ctaDescription}
            ctaButtonPrimary={site.ctaButtonPrimary}
            ctaButtonPrimaryUrl={site.ctaButtonPrimaryUrl}
            ctaButtonSecondary={site.ctaButtonSecondary}
            ctaButtonSecondaryUrl={site.ctaButtonSecondaryUrl}
          />
        </div>

        <div
          class="opacity-0 translate-y-6 transition-all duration-1000 ease-out scroll-reveal"
        >
          <ProductsSection
            productsTitle={site.productsTitle}
            productsDescription={site.productsDescription}
            products={products}
          />
        </div>

        <section class="space-y-8 md:space-y-12 lg:space-y-16">
          <div
            class="opacity-0 translate-y-6 transition-all duration-1000 ease-out scroll-reveal"
          >
            <SocialSection
              socialTitle={site.socialTitle}
              socialDescription={site.socialDescription}
              socials={site.socials}
            />
          </div>

          <div
            class="opacity-0 translate-y-6 transition-all duration-1000 ease-out scroll-reveal"
          >
            <Footer
              copyrightText={site.copyrightText}
              footerText={site.footerText}
            />
          </div>
        </section>
      </main>
    </div>
  </div>

  <ScrollToTop />

  <!-- Structured Data for SEO -->
  <StructuredData
    name={site.brandName}
    description={site.description}
    url={site.url}
    logo="/logo.svg"
    socials={Object.fromEntries(site.socials.map((s) => [s.name, s.url]))}
  />

  <!-- Animation Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Trigger page load animations immediately
      setTimeout(() => {
        document.querySelectorAll(".animate-in").forEach((el) => {
          el.classList.remove("opacity-0", "translate-y-6");
          el.classList.add("opacity-100", "translate-y-0");
        });
      }, 100);

      // Intersection Observer for scroll animations
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              setTimeout(() => {
                entry.target.classList.remove("opacity-0", "translate-y-6");
                entry.target.classList.add("opacity-100", "translate-y-0");
              }, 100);
              observer.unobserve(entry.target);
            }
          });
        },
        {
          threshold: 0.05,
          rootMargin: "50px 0px -10px 0px",
        }
      );

      // Observe scroll-reveal elements
      document.querySelectorAll(".scroll-reveal").forEach((el) => {
        observer.observe(el);
      });
    });
  </script>
</Layout>

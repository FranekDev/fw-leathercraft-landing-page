---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import StructuredData from "../components/StructuredData.astro";
import AnnouncementBanner from "../components/AnnouncementBanner.astro";
import Header from "../components/Header.astro";
import HeroSection from "../components/HeroSection.astro";
import ScrollIndicator from "../components/ScrollIndicator.astro";
import CTASection from "../components/CTASection.astro";
import ProductsSection from "../components/ProductsSection.astro";
import SocialSection from "../components/SocialSection.astro";
import Footer from "../components/Footer.astro";

const products = await getCollection("products");
const [siteEntry] = await getCollection("sites");

if (!siteEntry) {
  throw new Error(
    "No site configuration found. Please check your content/sites directory."
  );
}

const site = siteEntry.data;
---

<Layout title={site.title} description={site.description} url={site.url}>
  <AnnouncementBanner message={site.announcementMessage} />

  <!-- Main content container -->
  <div
    class="min-h-screen bg-(--bg) text-(--main) selection:text-(--bg) selection:bg-(--main)/60"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <main class="space-y-16">
        <Header
          brandName={site.brandName}
          headerButtonText={site.headerButtonText}
          headerButtonUrl={site.headerButtonUrl}
        />

        <HeroSection
          heroTitle={site.heroTitle}
          heroDescription={site.heroDescription}
          slotsAvailable={site.slotsAvailable}
          slotsAvailableText={site.slotsAvailableText}
          slotsUnavailableText={site.slotsUnavailableText}
        />
        <ScrollIndicator scrollText={site.scrollText} />

        <CTASection
          ctaTitle={site.ctaTitle}
          ctaSubtitle={site.ctaSubtitle}
          ctaDescription={site.ctaDescription}
          ctaButtonPrimary={site.ctaButtonPrimary}
          ctaButtonPrimaryUrl={site.ctaButtonPrimaryUrl}
          ctaButtonSecondary={site.ctaButtonSecondary}
          ctaButtonSecondaryUrl={site.ctaButtonSecondaryUrl}
        />

        <ProductsSection
          productsTitle={site.productsTitle}
          productsDescription={site.productsDescription}
          products={products}
        />

        <section class="space-y-8 md:space-y-12 lg:space-y-16">
          <SocialSection
            socialTitle={site.socialTitle}
            socialDescription={site.socialDescription}
            socials={site.socials}
          />

          <Footer
            copyrightText={site.copyrightText}
            footerText={site.footerText}
          />
        </section>
      </main>
    </div>
  </div>

  <!-- Structured Data for SEO -->
  <StructuredData
    name={site.brandName}
    description={site.description}
    url={site.url}
    logo="/logo.svg"
    socials={Object.fromEntries(site.socials.map((s) => [s.name, s.url]))}
  />
</Layout>
